<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Simple XSS Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex items-start justify-center p-6">
  <div class="w-full max-w-3xl space-y-4">
    <h1 class="text-xl font-semibold">Simple XSS Scanner</h1>

    <!-- Input row -->
    <div class="flex gap-2">
      <input id="target" type="url" placeholder="https://example.com/page?q=1"
             class="flex-1 rounded-md bg-slate-800 border border-slate-700 px-3 py-2 text-sm" required />
      <button id="scanBtn"
              class="rounded-md bg-emerald-400 text-black font-medium px-4"
              onclick="runScan()">Scan</button>
    </div>
    <p id="status" class="text-sm text-slate-400 hidden">Scanning…</p>
    <p id="error" class="text-sm text-rose-400 hidden"></p>

    <!-- Summary -->
    <div id="summary" class="rounded-md border border-slate-800 bg-slate-800/50 p-4 hidden">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
        <div><span class="text-slate-400">Page:</span> <span id="sumPage" class="break-all"></span></div>
        <div><span class="text-slate-400">Host:</span> <span id="sumHost"></span></div>
        <div><span class="text-slate-400">Params Found:</span> <span id="sumParams"></span></div>
        <div><span class="text-slate-400">Vuln Hits:</span> <span id="sumHits"></span></div>
      </div>
    </div>

    <!-- Affected parameters quick list (clickable) -->
    <div class="rounded-md border border-slate-800 bg-slate-800/50 p-4">
      <h2 class="text-sm font-medium mb-2">Affected Parameters</h2>
      <p id="none" class="text-sm text-slate-400">No results yet.</p>
      <div id="paramChips" class="flex flex-wrap gap-2"></div>
    </div>

    <!-- Detailed hits -->
    <div id="hitsWrap" class="space-y-3"></div>
  </div>

<script>
const API_BASE = 'https://xss-scanner-flask.onrender.com/xss';

const els = {
  target: document.getElementById('target'),
  scanBtn: document.getElementById('scanBtn'),
  status: document.getElementById('status'),
  error: document.getElementById('error'),
  summary: document.getElementById('summary'),
  sumPage: document.getElementById('sumPage'),
  sumHost: document.getElementById('sumHost'),
  sumParams: document.getElementById('sumParams'),
  sumHits: document.getElementById('sumHits'),
  none: document.getElementById('none'),
  paramChips: document.getElementById('paramChips'),
  hitsWrap: document.getElementById('hitsWrap'),
};

function setBusy(b) {
  els.scanBtn.disabled = b;
  els.status.classList.toggle('hidden', !b);
}

function escapeHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function openInNew(url) {
  if (!url) return;
  window.open(url, '_blank', 'noopener');
}

function copyText(t) {
  if (!t) return;
  navigator.clipboard.writeText(t).catch(()=>{});
}

function confBadge(conf) {
  const c = String(conf || '').toLowerCase();
  const base = 'text-xs px-2 py-0.5 rounded-full border';
  if (c === 'high') return `${base} bg-emerald-500/20 text-emerald-300 border-emerald-600/40`;
  if (c === 'medium') return `${base} bg-amber-500/20 text-amber-300 border-amber-600/40`;
  if (c === 'low') return `${base} bg-rose-500/20 text-rose-300 border-rose-600/40`;
  return `${base} bg-slate-700 text-slate-200 border-slate-600`;
}

function boolText(v) {
  return v === true ? 'Yes' : (v === false ? 'No' : '—');
}

async function runScan() {
  const url = (els.target.value || '').trim();
  if (!url) return;

  // reset
  els.error.classList.add('hidden'); els.error.textContent = '';
  els.paramChips.innerHTML = '';
  els.hitsWrap.innerHTML = '';
  els.none.classList.add('hidden');
  els.summary.classList.add('hidden');

  setBusy(true);
  try {
    const res = await fetch(`${API_BASE}?url=${encodeURIComponent(url)}`);
    const data = await res.json();

    // summary
    els.sumPage.textContent = data.page || '—';
    els.sumHost.textContent = data.host || '—';
    els.sumParams.textContent = data.params_found ?? 0;
    els.sumHits.textContent = data.hits_count ?? 0;
    els.summary.classList.remove('hidden');

    const hits = Array.isArray(data.hits) ? data.hits : [];
    if (!hits.length) {
      els.none.textContent = 'No vulnerable parameters found.';
      els.none.classList.remove('hidden');
      return;
    }

    // quick clickable chips (each param opens PoC if present, else target)
    const seen = new Set();
    hits.forEach(h => {
      const p = h && h.param;
      if (!p || seen.has(p)) return;
      seen.add(p);

      const a = document.createElement('a');
      const href = h.poc || h.target || '#';
      a.href = href;
      a.target = '_blank';
      a.rel = 'noopener';
      a.className = 'text-sm bg-emerald-500/20 text-emerald-200 border border-emerald-600/40 rounded-full px-3 py-1 hover:bg-emerald-500/30';
      a.textContent = p;
      els.paramChips.appendChild(a);
    });

    // detailed cards
    hits.forEach((h) => {
      const card = document.createElement('div');
      card.className = 'rounded-md border border-slate-800 bg-slate-800/60 p-4 text-sm';

      const param = escapeHtml(h.param || '—');
      const path = escapeHtml(h.path || '/');
      const conf = h.confidence || '—';
      const verified = boolText(h.verified_reflection);
      const reflLoc = escapeHtml(h.reflection_location || 'none');
      const csp = boolText(h.csp_present);
      const elapsed = escapeHtml(h.elapsed || '—');
      const ts = escapeHtml(h.timestamp || '—');
      const apiCall = escapeHtml(h.api_call || '—');
      const ver = escapeHtml(h.version || '—');
      const redir = escapeHtml(h.redir || 'none');
      const err = escapeHtml(h.knoxss_error || 'none');
      const target = h.target || '';
      const poc = h.poc || '';
      const notes = Array.isArray(h.notes) ? h.notes.map(escapeHtml).join(', ') : '—';

      card.innerHTML = `
        <div class="flex items-center justify-between gap-3 mb-2">
          <div class="text-base font-semibold">Param: <span class="text-sky-300">${param}</span></div>
          <span class="${confBadge(conf)}">${String(conf).toUpperCase()}</span>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1">
          <div><span class="text-slate-400">Path:</span> <span class="break-all">${path}</span></div>
          <div><span class="text-slate-400">Verified Reflection:</span> ${verified}</div>
          <div><span class="text-slate-400">Reflection Location:</span> ${reflLoc}</div>
          <div><span class="text-slate-400">CSP Present:</span> ${csp}</div>
          <div><span class="text-slate-400">Elapsed:</span> ${elapsed}</div>
          <div><span class="text-slate-400">Timestamp:</span> ${ts}</div>
          <div><span class="text-slate-400">API Call:</span> ${apiCall}</div>
          <div><span class="text-slate-400">Version:</span> ${ver}</div>
          <div><span class="text-slate-400">Redirect:</span> ${redir}</div>
          <div><span class="text-slate-400">KnoxSS Error:</span> ${err}</div>
          <div class="sm:col-span-2"><span class="text-slate-400">Target:</span> <span class="break-all">${escapeHtml(target || '—')}</span></div>
          <div class="sm:col-span-2"><span class="text-slate-400">PoC:</span> <span class="break-all">${escapeHtml(poc || '—')}</span></div>
          <div class="sm:col-span-2"><span class="text-slate-400">Notes:</span> <span>${notes}</span></div>
        </div>
        <div class="mt-3 flex flex-wrap gap-2">
          ${poc ? `<a class="text-xs underline text-emerald-300" href="${poc}" target="_blank" rel="noopener">Open PoC</a>` : ''}
          ${target ? `<a class="text-xs underline text-sky-300" href="${target}" target="_blank" rel="noopener">Open Target</a>` : ''}
          ${poc ? `<button class="text-xs underline text-slate-300" onclick="copyText('${jsEscape(poc)}')">Copy PoC</button>` : ''}
          ${target ? `<button class="text-xs underline text-slate-300" onclick="copyText('${jsEscape(target)}')">Copy Target</button>` : ''}
        </div>
      `;
      els.hitsWrap.appendChild(card);
    });

  } catch (e) {
    els.error.textContent = `Error: ${e}`;
    els.error.classList.remove('hidden');
  } finally {
    setBusy(false);
  }
}

function jsEscape(s) {
  return String(s).replace(/\\/g,'\\\\').replace(/'/g, "\\'").replace(/"/g, '\\"');
}
</script>
</body>
</html>
